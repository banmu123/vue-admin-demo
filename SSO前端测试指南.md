# SSO单点登录前端测试指南

本文档详细说明在只有前端环境的情况下，如何测试项目中的SSO单点登录功能。本项目已经实现了完整的前端SSO流程模拟，可以在没有后端服务的情况下进行功能演示和测试。

## 一、项目中的SSO实现架构

在前端环境中，项目通过以下组件模拟完整的SSO认证流程：

1. **SSO登录入口** (`/src/view/sso/login.vue`): 提供进入SSO认证流程的入口
2. **模拟SSO认证中心** (`/src/view/sso/auth.vue`): 模拟真实世界中的SSO认证服务器
3. **SSO回调处理** (`/src/view/sso/callback.vue`): 处理认证成功后的回调和token保存
4. **路由守卫** (`/src/permission.js`): 处理登录状态验证和路由权限控制

## 二、测试前的准备

确保项目已经正确安装并可以运行：

1. 确保已安装依赖：`npm install`
2. 启动开发服务器：`npm run serve`
3. 确保项目可以正常访问（默认地址：http://localhost:8080）

## 三、完整SSO流程测试步骤

### 1. 从常规登录页面进入SSO登录

1. **访问登录页面**：打开浏览器，访问 `http://localhost:8080/login`
2. **选择SSO登录**：点击"使用SSO单点登录"按钮
3. **SSO登录入口页面**：系统跳转到 `/sso/login` 页面，显示SSO登录流程说明
4. **开始SSO流程**：点击"开始SSO登录流程"按钮

### 2. 在模拟SSO认证中心进行认证

1. **认证页面**：系统跳转到模拟的SSO认证中心 `/sso/auth` 页面
2. **查看客户端信息**：确认显示的应用系统和请求ID信息
3. **输入演示账号**：
   - 用户名：`admin`
   - 密码：`123456`
4. **提交认证**：点击"登录认证"按钮
5. **查看日志**：打开浏览器控制台，可以看到以下日志信息：
   ```
   认证成功，生成token: mock_sso_token_1234567890
   重定向到应用回调URL: .../sso/callback?token=mock_sso_token_1234567890&state=...
   ```

### 3. 验证回调处理和系统登录

1. **回调页面**：系统自动跳转到 `/sso/callback` 页面
2. **处理认证**：页面显示"正在处理SSO认证，请稍候..."
3. **认证成功提示**：短暂显示"SSO认证成功，正在跳转到应用..."
4. **进入系统首页**：自动重定向到应用首页 `/`
5. **确认登录状态**：
   - 查看浏览器localStorage中的token是否已保存
   - 确认系统菜单和内容是否正确显示

### 4. 测试不同跳转场景

#### 4.1 直接访问受保护页面的跳转流程

1. **清除登录状态**：清除localStorage中的token
2. **访问受保护页面**：直接在浏览器地址栏输入 `http://localhost:8080/article`
3. **自动跳转**：系统应自动跳转到登录页面，URL中包含重定向参数
4. **SSO登录**：重复步骤1-3的SSO登录流程
5. **验证跳转**：登录成功后，系统应自动跳转到 `http://localhost:8080/article` 页面，而非首页

#### 4.2 测试认证失败场景

1. **清除登录状态**：清除localStorage中的token
2. **进入SSO流程**：按上述步骤进入模拟认证中心
3. **输入错误凭据**：输入错误的用户名或密码
4. **验证错误提示**：系统应显示认证失败提示信息

## 四、调试技巧

### 1. 查看关键日志

在整个测试过程中，建议打开浏览器控制台查看日志输出，关键日志包括：

- SSO登录流程开始时的state参数信息
- 认证成功后的token生成信息
- 回调页面的参数处理日志
- 路由守卫中的权限检查日志

### 2. 验证token存储

使用浏览器开发者工具检查localStorage中的token存储：

1. 打开浏览器开发者工具
2. 切换到"应用程序"(Application)或"存储"(Storage)标签
3. 检查localStorage中是否有正确的token值

### 3. 验证路由注册

测试完成SSO登录后，检查动态路由是否正确注册：

1. 在浏览器控制台中执行以下代码：
   ```javascript
   console.log(this.$router.options.routes)
   ```
2. 确认路由表中是否包含了动态注册的路由

## 五、常见问题排查

### 1. 登录后页面空白

- 检查路由守卫是否正确注册动态路由
- 确认`permission.js`中的`hasRoutesRegistered`函数逻辑是否正确
- 验证store中的routes getter是否正确返回路由数据

### 2. SSO登录后跳转到登录页而非首页

- 检查`callback.vue`中的重定向逻辑
- 确认`redirectUrl`的处理是否正确

### 3. 认证成功但未跳转

- 检查`callback.vue`中的`processToken`方法
- 确认token是否正确保存到localStorage和Vuex

## 六、扩展测试（可选）

### 1. 测试多标签页共享登录状态

1. 在一个标签页完成SSO登录
2. 打开新标签页访问应用
3. 验证新标签页是否自动登录，无需重新认证

### 2. 测试会话过期场景

1. 完成SSO登录
2. 手动删除localStorage中的token
3. 刷新页面
4. 验证系统是否自动跳转到登录页面

---

通过以上步骤，您可以在只有前端环境的情况下，完整测试项目中实现的SSO单点登录功能。本项目通过前端模拟实现了SSO认证中心，使得即使在没有后端服务的情况下，也能演示和测试完整的SSO登录流程。